<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Budget Planner Dashboard</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>
  <body>
    <div class="d-flex" id="wrapper">
      <!-- Sidebar -->
      <div class="bg-dark border-right" id="sidebar-wrapper">
        <div class="sidebar-heading text-white">
          <i class="fas fa-calculator me-2"></i>Budget Planner
        </div>
        <div class="list-group list-group-flush">
          <a
            href="#"
            class="list-group-item list-group-item-action bg-dark text-white active"
            onclick="showSection('budget-planner')"
            ><i class="fas fa-calculator me-2"></i>Budget Planner</a
          >
          <a
            href="#"
            class="list-group-item list-group-item-action bg-dark text-white"
            onclick="showSection('dashboard')"
            ><i class="fas fa-tachometer-alt me-2"></i>Dashboard</a
          >
          <a
            href="#"
            class="list-group-item list-group-item-action bg-dark text-white"
            onclick="showSection('reports')"
            ><i class="fas fa-chart-bar me-2"></i>Reports</a
          >
          <a
            href="#"
            class="list-group-item list-group-item-action bg-dark text-white"
            onclick="showSection('settings')"
            ><i class="fas fa-cog me-2"></i>Settings</a
          >
        </div>
      </div>
      <!-- /#sidebar-wrapper -->

      <!-- Page Content -->
      <div id="page-content-wrapper">
        <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
          <div class="container-fluid">
            <button class="btn btn-primary" id="menu-toggle">
              <i class="fas fa-bars"></i>
            </button>
            <h4 class="mb-0">Financial Dashboard</h4>
          </div>
        </nav>

        <div class="container-fluid main-container">
          <!-- Budget Planner Section -->
          <div id="budget-planner" class="section fade-in">
            <div class="row">
              <!-- Input Form -->
              <div class="col-lg-6 mb-4">
                <div class="card card-custom">
                  <div class="card-header card-header-custom">
                    <h3 class="mb-0">
                      <i class="fas fa-calculator me-2"></i>Budget Planner
                    </h3>
                  </div>
                  <div class="card-body card-body-custom">
                    <form id="budgetForm">
                      <div class="form-group">
                        <label for="projectCost" class="form-label"
                          >Project Cost (₦)</label
                        >
                        <input
                          type="number"
                          class="form-control"
                          id="projectCost"
                          placeholder="Enter project cost in Naira"
                          min="0"
                          step="0.01"
                        />
                      </div>

                      <div class="form-group">
                        <label for="duration" class="form-label"
                          >Duration (months)</label
                        >
                        <input
                          type="number"
                          class="form-control"
                          id="duration"
                          placeholder="Enter duration in months"
                          min="1"
                          step="1"
                        />
                      </div>

                      <div class="form-group">
                        <label for="interestRate" class="form-label"
                          >Expected Interest Rate (%)</label
                        >
                        <input
                          type="number"
                          class="form-control"
                          id="interestRate"
                          placeholder="Enter interest rate"
                          min="0"
                          max="100"
                          step="0.1"
                        />
                      </div>

                      <div class="form-group">
                        <label for="frequency" class="form-label"
                          >Contribution Frequency</label
                        >
                        <select class="form-select" id="frequency">
                          <option value="">Select frequency</option>
                          <option value="monthly">Monthly</option>
                          <option value="quarterly">Quarterly</option>
                          <option value="semi-annually">Semi-Annually</option>
                          <option value="annually">Annually</option>
                        </select>
                      </div>

                      <div class="form-group">
                        <label for="startDate" class="form-label"
                          >Start Date</label
                        >
                        <input
                          type="date"
                          class="form-control"
                          id="startDate"
                        />
                      </div>

                      <div class="text-center">
                        <button type="submit" class="btn btn-primary-custom">
                          <i class="fas fa-calculator me-2"></i>Calculate
                          Sinking Fund
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>

              <!-- Charts and Summary -->
              <div class="col-lg-6 mb-4">
                <div class="row">
                  <!-- Accumulated Fund Chart -->
                  <div class="col-12 mb-4">
                    <div class="card card-custom">
                      <div class="card-body card-body-custom text-center">
                        <h5 class="mb-3">Accumulated Fund Over Time</h5>
                        <div class="bar-chart" id="barChart"></div>
                      </div>
                    </div>
                  </div>

                  <!-- Budget Distribution -->
                  <div class="col-12 mb-4">
                    <div class="card card-custom">
                      <div class="card-body card-body-custom text-center">
                        <h5 class="mb-3">Budget Distribution</h5>
                        <div class="pie-chart" id="pieChart"></div>
                        <div
                          class="mt-3 d-flex justify-content-center gap-3 flex-wrap"
                        >
                          <span
                            ><i
                              class="fas fa-circle"
                              style="color: var(--secondary-color)"
                            ></i>
                            Principal</span
                          >
                          <span
                            ><i
                              class="fas fa-circle"
                              style="color: var(--success-color)"
                            ></i>
                            Interest</span
                          >
                          <span
                            ><i
                              class="fas fa-circle"
                              style="color: var(--warning-color)"
                            ></i>
                            Target</span
                          >
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Loading Spinner -->
            <div class="loading-spinner" id="loadingSpinner">
              <div class="spinner"></div>
            </div>

            <!-- Results Table -->
            <div class="row" id="resultsSection" style="display: none">
              <div class="col-12">
                <div class="card card-custom">
                  <div class="card-header card-header-custom">
                    <h4 class="mb-0">
                      <i class="fas fa-table me-2"></i>Sinking Fund Schedule
                    </h4>
                  </div>
                  <div class="card-body p-0">
                    <div class="table-responsive">
                      <table class="table table-custom mb-0">
                        <thead>
                          <tr>
                            <th>Month</th>
                            <th>Contribution</th>
                            <th>Interest</th>
                            <th>Balance</th>
                          </tr>
                        </thead>
                        <tbody id="resultsTable"></tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Summary Stats -->
            <div class="row" id="summarySection" style="display: none">
              <div class="col-md-3 mb-3">
                <div class="stats-card">
                  <div class="stats-value" id="totalContribution">₦0</div>
                  <div class="stats-label">Total Contribution</div>
                </div>
              </div>
              <div class="col-md-3 mb-3">
                <div class="stats-card">
                  <div class="stats-value" id="totalInterest">₦0</div>
                  <div class="stats-label">Total Interest</div>
                </div>
              </div>
              <div class="col-md-3 mb-3">
                <div class="stats-card">
                  <div class="stats-value" id="monthlyContribution">₦0</div>
                  <div class="stats-label">Periodic Payment</div>
                </div>
              </div>
              <div class="col-md-3 mb-3">
                <div class="stats-card">
                  <div class="stats-value" id="finalBalance">₦0</div>
                  <div class="stats-label">Final Balance</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Dashboard Section -->
          <div id="dashboard" class="section fade-in" style="display: none">
            <div class="row">
              <div class="col-lg-8">
                <div class="card card-custom">
                  <div class="card-header card-header-custom">
                    <h3 class="mb-0">
                      <i class="fas fa-chart-line me-2"></i>Financial Overview
                    </h3>
                  </div>
                  <div class="card-body">
                    <canvas id="mainChart" height="150"></canvas>
                  </div>
                </div>
              </div>
              <div class="col-lg-4">
                <div class="card card-custom">
                  <div class="card-header card-header-custom">
                    <h3 class="mb-0">
                      <i class="fas fa-tasks me-2"></i>Summary
                    </h3>
                  </div>
                  <div class="card-body">
                    <ul class="list-group list-group-flush">
                      <li
                        class="list-group-item d-flex justify-content-between align-items-center"
                      >
                        Total Savings
                        <span class="badge bg-primary rounded-pill"
                          >₦1,200,000</span
                        >
                      </li>
                      <li
                        class="list-group-item d-flex justify-content-between align-items-center"
                      >
                        Next Contribution
                        <span class="badge bg-info rounded-pill"
                          >₦50,000</span
                        >
                      </li>
                      <li
                        class="list-group-item d-flex justify-content-between align-items-center"
                      >
                        Interest Earned
                        <span class="badge bg-success rounded-pill"
                          >₦25,000</span
                        >
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Other Sections -->
          <div id="reports" class="section fade-in" style="display: none">
            <h4>Reports Section</h4>
          </div>
          <div id="settings" class="section fade-in" style="display: none">
            <h4>Settings Section</h4>
          </div>
        </div>
      </div>
      <!-- /#page-content-wrapper -->
    </div>
    <!-- /#wrapper -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="assets/js/data.js"></script>
    <script>
      // Global variables
      let calculationResults = [];
      let mainChart;

      // Initialize the application
      document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("startDate").valueAsDate = new Date();
        document
          .getElementById("budgetForm")
          .addEventListener("submit", calculateSinkingFund);
        document
          .getElementById("menu-toggle")
          .addEventListener("click", function () {
            document.getElementById("wrapper").classList.toggle("toggled");
          });
        showSection("budget-planner"); // Show default section
        initializeDashboardChart();
      });

      // Navigation function
      function showSection(sectionId) {
        const sections = document.querySelectorAll(".section");
        sections.forEach((section) => {
          section.style.display = "none";
        });
        document.getElementById(sectionId).style.display = "block";

        const navLinks = document.querySelectorAll(
          "#sidebar-wrapper .list-group-item"
        );
        navLinks.forEach((link) => {
          link.classList.remove("active");
        });
        document
          .querySelector(`[onclick="showSection('${sectionId}')"]`)
          .classList.add("active");

        if (sectionId === "dashboard") {
          updateDashboard();
        }
      }

      // Main calculation function
      function calculateSinkingFund(event) {
        event.preventDefault();
        const projectCost = parseFloat(
          document.getElementById("projectCost").value
        );
        const duration = parseInt(document.getElementById("duration").value);
        const annualRate =
          parseFloat(document.getElementById("interestRate").value) / 100;
        const frequency = document.getElementById("frequency").value;
        const startDate = new Date(document.getElementById("startDate").value);

        if (
          !validateInputs(
            projectCost,
            duration,
            annualRate,
            frequency,
            startDate
          )
        )
          return;

        showLoading(true);
        setTimeout(() => {
          try {
            const results = performCalculation(
              projectCost,
              duration,
              annualRate,
              frequency,
              startDate
            );
            displayResults(results);
            updateCharts(results);
            updateSummaryStats(results);
            calculationResults = results; // Store results globally
            showLoading(false);
          } catch (error) {
            console.error("Calculation error:", error);
            showAlert("An error occurred during calculation.", "danger");
            showLoading(false);
          }
        }, 500);
      }

      // Input validation
      function validateInputs(
        projectCost,
        duration,
        annualRate,
        frequency,
        startDate
      ) {
        if (isNaN(projectCost) || projectCost <= 0) {
          showAlert("Invalid project cost.", "danger");
          return false;
        }
        if (isNaN(duration) || duration <= 0) {
          showAlert("Invalid duration.", "danger");
          return false;
        }
        if (isNaN(annualRate) || annualRate < 0) {
          showAlert("Invalid interest rate.", "danger");
          return false;
        }
        if (!frequency) {
          showAlert("Select a frequency.", "warning");
          return false;
        }
        if (!startDate || isNaN(startDate.getTime())) {
          showAlert("Invalid start date.", "warning");
          return false;
        }
        return true;
      }

      // Show custom alert
      function showAlert(message, type = "info") {
        let alertContainer = document.getElementById("alert-container");
        if (!alertContainer) {
          alertContainer = document.createElement("div");
          alertContainer.id = "alert-container";
          alertContainer.style.cssText =
            "position: fixed; top: 20px; right: 20px; z-index: 9999;";
          document.body.appendChild(alertContainer);
        }
        const alertDiv = document.createElement("div");
        alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
        alertDiv.innerHTML = `${message}<button type="button" class="btn-close" data-bs-dismiss="alert"></button>`;
        alertContainer.appendChild(alertDiv);
        setTimeout(() => alertDiv.remove(), 5000);
      }

      // Perform calculation
      function performCalculation(
        projectCost,
        duration,
        annualRate,
        frequency,
        startDate
      ) {
        const freqMap = {
          monthly: 12,
          quarterly: 4,
          "semi-annually": 2,
          annually: 1,
        };
        const periodsPerYear = freqMap[frequency];
        const totalPeriods = duration * (periodsPerYear / 12);
        const periodRate = annualRate / periodsPerYear;
        const payment =
          periodRate === 0
            ? projectCost / totalPeriods
            : (projectCost * periodRate) /
              (Math.pow(1 + periodRate, totalPeriods) - 1);

        const schedule = [];
        let balance = 0,
          totalContributions = 0,
          totalInterest = 0;
        for (let p = 1; p <= totalPeriods; p++) {
          const interest = balance * periodRate;
          balance += payment + interest;
          totalContributions += payment;
          totalInterest += interest;
          schedule.push({
            period: p,
            date: new Date(
              new Date(startDate).setMonth(
                startDate.getMonth() + p * (12 / periodsPerYear)
              )
            ),
            contribution: payment,
            interest,
            balance,
          });
        }
        return {
          schedule,
          payment,
          totalContributions,
          totalInterest,
          finalBalance: balance,
          projectCost,
          frequency,
        };
      }

      // Display results
      function displayResults(results) {
        const tbody = document.getElementById("resultsTable");
        tbody.innerHTML = "";
        results.schedule.forEach((row) => {
          const tr = tbody.insertRow();
          tr.innerHTML = `
                  <td>${row.period}</td>
                  <td>${formatCurrency(row.contribution)}</td>
                  <td>${formatCurrency(row.interest)}</td>
                  <td>${formatCurrency(row.balance)}</td>
              `;
        });
        document.getElementById("resultsSection").style.display = "block";
      }

      // Update summary stats
      function updateSummaryStats(results) {
        document.getElementById("totalContribution").textContent =
          formatCurrency(results.totalContributions);
        document.getElementById("totalInterest").textContent = formatCurrency(
          results.totalInterest
        );
        document.getElementById("monthlyContribution").textContent =
          formatCurrency(results.payment);
        document.getElementById("finalBalance").textContent = formatCurrency(
          results.finalBalance
        );
        document.getElementById("summarySection").style.display = "flex";
      }

      // Update charts
      function updateCharts(results) {
        updateBarChart(results);
        updatePieChart(results);
      }

      function updateBarChart(results) {
        const barChart = document.getElementById("barChart");
        barChart.innerHTML = "";
        const maxBalance = results.finalBalance;
        results.schedule.forEach((item) => {
          const bar = document.createElement("div");
          bar.className = "bar";
          bar.style.height = `${(item.balance / maxBalance) * 100}%`;
          bar.title = `Period ${item.period}: ${formatCurrency(
            item.balance
          )}`;
          barChart.appendChild(bar);
        });
      }

      function updatePieChart(results) {
        const { totalContributions, totalInterest, projectCost } = results;
        const total = totalContributions + totalInterest;
        const contribPercent = (totalContributions / total) * 360;
        const interestPercent = (totalInterest / total) * 360;
        const pieChart = document.getElementById("pieChart");
        pieChart.style.background = `conic-gradient(
              var(--secondary-color) 0deg ${contribPercent}deg,
              var(--success-color) ${contribPercent}deg ${
          contribPercent + interestPercent
        }deg,
              #e0e0e0 ${contribPercent + interestPercent}deg 360deg
          )`;
      }

      // Dashboard functions
      function initializeDashboardChart() {
        const ctx = document.getElementById("mainChart").getContext("2d");
        mainChart = new Chart(ctx, {
          type: "line",
          data: {
            labels: [],
            datasets: [
              {
                label: "Balance Over Time",
                data: [],
                borderColor: "rgba(52, 152, 219, 1)",
                backgroundColor: "rgba(52, 152, 219, 0.2)",
                fill: true,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
          },
        });
      }

      function updateDashboard() {
        if (calculationResults && calculationResults.schedule.length > 0) {
          const {
            schedule,
            totalContributions,
            totalInterest,
            payment,
          } = calculationResults;
          const labels = schedule.map((s) => `Period ${s.period}`);
          const data = schedule.map((s) => s.balance);
          mainChart.data.labels = labels;
          mainChart.data.datasets[0].data = data;
          mainChart.update();

          // Update summary widgets
          document.querySelector(
            "#dashboard .list-group-item:nth-child(1) .badge"
          ).textContent = formatCurrency(
            totalContributions + totalInterest
          );
          document.querySelector(
            "#dashboard .list-group-item:nth-child(2) .badge"
          ).textContent = formatCurrency(payment);
          document.querySelector(
            "#dashboard .list-group-item:nth-child(3) .badge"
          ).textContent = formatCurrency(totalInterest);
        }
      }

      // Utility functions
      function showLoading(show) {
        document.getElementById("loadingSpinner").style.display = show
          ? "flex"
          : "none";
      }

      function formatCurrency(amount) {
        return new Intl.NumberFormat("en-NG", {
          style: "currency",
          currency: "NGN",
        }).format(amount);
      }
    </script>
  </body>
</html>
